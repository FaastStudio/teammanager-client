<template>
  <div class="wrapper">
    <side-bar>
      <template slot="links">
        <sidebar-link to="/dashboard" name="Dashboard" icon="tim-icons icon-chart-pie-36"/>
        <!-- <sidebar-link to="/training/create" :name="$t('sidebar.training')" icon="tim-icons icon-spaceship"/> -->
        <sidebar-link to="/icons" name="Icons" icon="tim-icons icon-atom"/>
        <!-- <sidebar-link to="/maps" :name="$t('sidebar.maps')" icon="tim-icons icon-pin"/> -->
        <sidebar-link to="/notifications" name="Notifications" icon="tim-icons icon-bell-55"/>
        <!-- <sidebar-link to="/profile" :name="$t('sidebar.userProfile')" icon="tim-icons icon-single-02"/> -->
        <!-- <sidebar-link to="/table-list" :name="$t('sidebar.tableList')" icon="tim-icons icon-puzzle-10"/> -->
        <!-- <sidebar-link to="/typography" :name="$t('sidebar.typography')" icon="tim-icons icon-align-center"/> -->
        <base-button @click="logout()" type="danger" class="ml-4" fill>Logout</base-button>
      </template>
    </side-bar>
    <div class="main-panel">
      <top-navbar></top-navbar>

      <dashboard-content @click.native="toggleSidebar">

      </dashboard-content>

      <content-footer></content-footer>
    </div>
  </div>
</template>
<style lang="scss">
</style>
<script>
import TopNavbar from './TopNavbar.vue'
import ContentFooter from './ContentFooter.vue'
import DashboardContent from './Content.vue'
import BaseButton from '@/components/BaseButton.vue'
import UserService from '@/services/user.service.js'
import { TokenService } from '@/services/storage.service.js'
import ApiService from '@/services/api.service.js'

export default {
  components: {
    TopNavbar,
    ContentFooter,
    DashboardContent,
    BaseButton
  },
  methods: {
    toggleSidebar() {
      if (this.$sidebar.showSidebar) {
        this.$sidebar.displaySidebar(false)
      }
    },
    logout() {
      UserService.logout()
      if (!TokenService.getToken()) {
        this.$store.commit('setAsLoggedOut')
      }
      if (!this.$store.state.auth.loggedIn) {
        this.$router.push('/login')
      }
    },
    fetchUserData() {
      const userId = this.$store.state.user.userId
      let customRequest = {
        method: 'GET',
        url: `api/auth/me`,
        data: {
          userId
        }
      }
      ApiService.customRequest(customRequest).then(res => {
        this.$store.state.user = res.data
      })
    }
  },
  mounted() {
    this.fetchUserData()
  }
}
</script>
